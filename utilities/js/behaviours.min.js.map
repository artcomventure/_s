{"version":3,"file":"behaviours.min.js","names":["$","className","behaviours","add","name","callback","priority","arguments","length","undefined","checkForValidName","groups","split","scope","forEach","group","depth","toString","prio","Object","keys","filter","key","Number","isInteger","console","error","concat","remove","recursive","attach","$context","settings","HTMLDocument","HTMLElement","callbacks","addCallbacks","push","sort","reduce","result","values","flat","document","test","addEventListener","window","behavioursScope","behavioursName"],"sources":["behaviours.js"],"sourcesContent":["/**\n * Behaviours v2.0.0\n * https://gist.github.com/enoks/77b98aded9b21e082bfc9625eb5e0870\n *\n * ```\n * Behaviours.add( '[group:[group:]]name', ( $context, settings ) => {}, 10 ); // add behaviour\n * Behaviours.attach( '[group:[group:]]name' ); // ...\n * ```\n *\n * Copyright 2023, Stefan KÃ¤sche\n * Licensed under MIT\n */\n\n// Changelog:\n//\n// 2.0.0 - 2023-08-21\n// Refactoring.\n//\n// ?.?.?0 - ????-??-??\n// ???\n//\n// 1.0.0 - ????-??-??\n// Init.\n\n;\n(function ( $, className ) {\n\n  var behaviours = {};\n\n  $[className] = {\n    /**\n     * @param {string} name [[GROUP:]GROUP:]NAME\n     * @param {function} callback\n     * @param {number} priority (optional)\n     */\n    add: function ( name, callback, priority = 10 ) {\n      if ( !checkForValidName( name ) ) return;\n\n      const groups = name.split( ':' );\n\n      let scope = behaviours;\n      groups.forEach( ( group, depth ) => {\n        if ( (depth === groups.length - 1) && !!scope[group] ) {\n          scope = scope[group];\n\n          if ( !!scope[priority] && scope[priority].toString() === callback.toString() )\n            return; // prevent duplicated entry\n          else {\n            const prio = Object.keys( scope ).filter( key => Number.isInteger( key * 1 ) )[0] || false;\n\n            if ( prio === false ) return scope[priority] = callback;\n            else if ( scope[prio].toString() === callback.toString() ) {\n              // change priority\n              delete scope[prio];\n              scope[priority] = callback;\n              return;\n            }\n          }\n\n          return console.error( `A behaviour with the name '${name}' already exists.` );\n        }\n\n        if ( !scope[group] ) scope = scope[group] = {}\n        else scope = scope[group];\n\n        if ( depth === groups.length -1 ) {\n          scope[priority] = callback;\n        }\n      } )\n\n      return this;\n    },\n\n    /**\n     * @param {string} name  [[GROUP:]GROUP:]NAME\n     * @param {boolean} recursive\n     */\n    remove: function ( name, recursive = false ) {\n      if ( !checkForValidName( name ) ) return;\n\n      const groups = name.split( ':' );\n\n      let scope = behaviours;\n      groups.forEach( ( group, depth) => {\n        if ( !scope ) return;\n\n        if ( !scope[group] ) {\n          return scope = console.error( `A behaviour or group with the name '${name}' doesn't exists.` )\n        }\n\n        if ( depth === groups.length - 1 ) {\n          if ( recursive ) delete scope[group];\n          else {\n            const priority = Object.keys( scope[group] ).filter( key => Number.isInteger( key * 1 ) )[0] || false;\n\n            if ( priority === false )\n              return console.error(\n                  `There is no behaviour named '${name}'. If you meant to remove the group '${name}' please use \\`${className}.remove( '${name}', true );\\`.`\n              );\n            else delete scope[group][priority];\n          }\n        }\n\n        scope = scope[group];\n      } );\n\n      return this;\n    },\n\n    /**\n     * @param {string} name  [[GROUP:]GROUP:]NAME (optional)\n     * @param {HTMLDocument|HTMLElement} $context (optional)\n     * @param {object} settings (optional)\n     */\n    attach: function ( name, $context, settings ) {\n      // shortcut: name is settings\n      if ( name && name.toString() === '[object Object]' && !$context && !settings ) {\n        settings = name;\n        name = '';\n      }\n\n      // shortcut: $context is settings\n      if ( settings && settings.toString() !== '[object Object]' && $context && $context.toString() === '[object Object]' ) {\n        settings = $context;\n        $context = null;\n      }\n\n      // shortcut: name is $context\n      if ( (name instanceof HTMLDocument || name instanceof HTMLElement) && !($context instanceof HTMLDocument || $context instanceof HTMLElement) ) {\n        $context = name;\n        name = '';\n      }\n\n      let callbacks = {}\n\n      let scope = behaviours;\n      if ( name ) {\n        if ( !checkForValidName( name ) ) return;\n\n        const groups = name.split( ':' );\n\n        groups.forEach( ( group) => {\n          if ( !scope ) return;\n\n          if ( !scope[group] ) {\n            return scope = console.error( `A behaviour or group with the name '${name}' doesn't exists.` );\n          }\n\n          scope = scope[group];\n        } );\n      }\n\n      // group all callbacks in scope by priority\n      (function addCallbacks( scope ) {\n        Object.keys( scope ).forEach( key => {\n          if ( Number.isInteger( key * 1 ) ) {\n            if ( !callbacks[key] ) callbacks[key] = [];\n            callbacks[key].push( scope[key] );\n          }\n          else addCallbacks( scope[key] );\n        } )\n      })( scope );\n\n      // sort by key aka priority\n      callbacks = Object.keys( callbacks ).sort().reduce(function (result, key) {\n        result[key] = callbacks[key];\n        return result;\n      }, {});\n\n      Object.values( callbacks ).flat().forEach( callback => callback( $context || document, settings ) );\n\n      return this;\n    }\n  };\n\n  function checkForValidName( name ) {\n    if ( /(^|:)\\d+(:|$)/.test( name ) )\n      return console.error( \"Name (or group) mustn't be numeric.\" );\n\n    return true;\n  }\n\n  // eventually call all behaviours once dom is loaded\n  document.addEventListener( 'DOMContentLoaded', function () {\n    $[className].attach();\n  }, false );\n\n})(window.behavioursScope||window, window.behavioursName||'Behaviours' );\n"],"mappings":"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"}