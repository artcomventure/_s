(()=>{"use strict";var e={n:t=>{var l=t&&t.__esModule?()=>t.default:()=>t;return e.d(l,{a:l}),l},d:(t,l)=>{for(var o in l)e.o(l,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:l[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.React,l=window.wp.i18n,o=window.wp.blocks,s=window.wp.blockEditor,n=window.wp.components,a=window.wp.data,r=window.wp.serverSideRender;var i=e.n(r);const p=window.wp.compose,c=window.wp.element,m=window.wp.primitives,d=(0,t.createElement)(m.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,t.createElement)(m.Path,{d:"M15.6 6.5l-1.1 1 2.9 3.3H8c-.9 0-1.7.3-2.3.9-1.4 1.5-1.4 4.2-1.4 5.6v.2h1.5v-.3c0-1.1 0-3.5 1-4.5.3-.3.7-.5 1.3-.5h9.2L14.5 15l1.1 1.1 4.6-4.6-4.6-5z"})),u=(0,t.createElement)(m.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,t.createElement)(m.Path,{d:"M19 3H5c-.6 0-1 .4-1 1v7c0 .5.4 1 1 1h14c.5 0 1-.4 1-1V4c0-.6-.4-1-1-1zM5.5 10.5v-.4l1.8-1.3 1.3.8c.3.2.7.2.9-.1L11 8.1l2.4 2.4H5.5zm13 0h-2.9l-4-4c-.3-.3-.8-.3-1.1 0L8.9 8l-1.2-.8c-.3-.2-.6-.2-.9 0l-1.3 1V4.5h13v6zM4 20h9v-1.5H4V20zm0-4h16v-1.5H4V16z"})),_={blockId:{type:"string"},post_type:{type:"string",default:"post"},filter:{type:"string",default:"{}"},posts_per_page:{type:"string",default:""},orderby:{type:"string",default:"date"},theme:{type:"string",default:"grid"},group_by_month:{type:"boolean",default:!1},columns:{type:"string",default:"1"},more:{type:"string",default:""}},g=e=>{const t={...e};return Object.keys(t).map((e=>{_[e]&&_[e].default!==t[e]&&""!==t[e]||delete t[e]})),t};(0,o.registerBlockType)("posts-list/preview",{title:(0,l.__)("Posts List","posts-list"),parent:["posts-list/block"],attributes:_});const h=(0,p.compose)([(0,p.withState)(),(0,a.withSelect)(((e,t,l)=>{const{getPostTypes:o,getSite:s,getEntityRecords:n,getTaxonomy:a}=e("core");_.posts_per_page.default=(s()||{}).posts_per_page||10;let r=o({per_page:-1})||[];r=r.filter((e=>e.viewable));const i={};return r.forEach((e=>{e.taxonomies.forEach((e=>{const t=n("taxonomy",e,{per_page:100});t&&t.length&&(i[e]={labels:{},terms:t,...a(e)||{}})}))})),{post_types:r,taxonomies:i}}))])((({post_types:e,taxonomies:o,attributes:a,setAttributes:r,...p})=>{const{blockId:m,post_type:u,posts_per_page:h,group_by_month:b,theme:w,columns:f,orderby:y,more:E}=a;(0,c.useEffect)((()=>{m||r({blockId:p.clientId})}));const v=function(e){let t;try{t=decodeURIComponent(e),t=JSON.parse(t)}catch(e){t={}}return t}(a.filter),x=e.filter((e=>e.slug===u))[0]||e[0]||{},N=document.getElementById(`block-${p.clientId}`);return N&&N.setAttribute("data-grid",a.columns),(0,t.createElement)(t.Fragment,null,(0,t.createElement)(i(),{block:"posts-list/preview",attributes:g(a)}),(0,t.createElement)(s.InspectorControls,null,(0,t.createElement)(n.PanelBody,{title:(0,l.__)("Settings"),className:"posts-list-settings-panel"},(0,t.createElement)(t.Fragment,null,(0,t.createElement)(n.SelectControl,{label:(0,l.__)("Post type"),value:u,options:e.map((e=>({value:e.slug,label:e.name}))),onChange:e=>{r({post_type:e}),r({filter:"{}"})}}),!!Object.keys(o).length&&(x.taxonomies||[]).length&&(0,t.createElement)(n.PanelBody,{title:(0,l.__)("Filter by","posts-list"),className:"posts-list-filter",initialOpen:!1,icon:d},(0,t.createElement)("p",{className:"description"},(0,l.__)("Terms are filtered with OR within a taxonomy and with AND between taxonomies.","posts-list")),x.taxonomies.map((e=>!!o[e]&&(0,t.createElement)(n.BaseControl,{label:o[e].labels.name||e},o[e].terms.map((o=>(0,t.createElement)(n.__experimentalToggleGroupControl,{label:o.name,isDeselectable:!0,value:v[e]?v[e].IN&&v[e].IN.indexOf(o.id)>=0?"IN":v[e]["NOT IN"]&&v[e]["NOT IN"].indexOf(o.id)>=0?"NOT IN":"":"",onChange:t=>{var l;v[e]&&["IN","NOT IN"].forEach((t=>{if(!v[e][t])return;const l=v[e][t].indexOf(o.id);l>=0&&delete v[e][t][l]})),t&&(v[e]||(v[e]={}),v[e][t]||(v[e][t]=[]),v[e][t].push(o.id)),Object.keys(v).forEach((e=>{Object.keys(v[e]).forEach((t=>{v[e][t]=Object.values(v[e][t].filter((e=>e))),v[e][t].length||delete v[e][t]})),Object.keys(v[e]).length||delete v[e]})),r({filter:(l={...v},"object"==typeof l&&null!==l&&(l=encodeURIComponent(JSON.stringify(l))),l)})}},(0,t.createElement)(n.__experimentalToggleGroupControlOption,{value:"IN",label:(0,l.__)("+","posts-list")}),(0,t.createElement)(n.__experimentalToggleGroupControlOption,{value:"NOT IN",label:(0,l.__)("-","posts-list")})))))))),(0,t.createElement)(n.TextControl,{label:(0,l.__)("Theme","posts-list"),value:w,placeholder:_.theme.default,onChange:e=>r({theme:e})}),(0,t.createElement)(n.ToggleControl,{label:(0,l.__)("Group by month","posts-list"),className:"hidden",checked:b,onChange:e=>r({group_by_month:e})}),(0,t.createElement)(n.Flex,null,(0,t.createElement)(n.FlexBlock,null,(0,t.createElement)(n.__experimentalNumberControl,{label:(0,l.__)("Number of posts","posts-list"),min:-1,value:h,placeholder:_.posts_per_page.default,onChange:e=>r({posts_per_page:e})})),"grid"===(w||_.theme.default)&&(0,t.createElement)(n.FlexBlock,null,(0,t.createElement)(n.__experimentalNumberControl,{label:(0,l.__)("Columns"),min:1,max:9,value:f,placeholder:_.columns.default,onChange:e=>r({columns:e})}))),!1,(0,t.createElement)(n.TextControl,{label:(0,l.__)("Load more"),help:(0,l.__)('If there are less results than the setting on "Number of posts", the button is not added.',"posts-list"),placeholder:(0,l.__)("Button text"),value:E,onChange:e=>r({more:e})})))))}));(0,o.registerBlockType)("posts-list/block",{title:(0,l.__)("Posts List","posts-list"),description:(0,l.__)("Add grid of posts.","posts-list"),icon:u,category:"widgets",keywords:[(0,l.__)("Testimonials","testimonial")],supports:{align:["wide","full"],color:{background:!0}},attributes:_,edit:e=>(0,t.createElement)(h,{...e}),save:function({attributes:e,...l}){const o=[];return new URLSearchParams(g(e)).forEach(((e,t)=>{["blockId"].indexOf(t)>=0||o.push(`${t}="${e}"`)})),(0,t.createElement)("div",{"data-id":e.blockId,"data-grid":e.columns,className:`${e.post_type}-posts-list wp-block-group is-layout-${e.theme||_.theme.default} wp-block-group-is-layout-${e.theme||_.theme.default}`},(0,t.createElement)(c.RawHTML,null,`[posts-list ${o.join(" ")}]`))}})})();