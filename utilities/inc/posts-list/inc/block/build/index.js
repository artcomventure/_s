(()=>{"use strict";var e={n:t=>{var l=t&&t.__esModule?()=>t.default:()=>t;return e.d(l,{a:l}),l},d:(t,l)=>{for(var o in l)e.o(l,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:l[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.React,l=window.wp.i18n,o=window.wp.blocks,s=window.wp.blockEditor,n=window.wp.components,a=window.wp.data,r=window.wp.serverSideRender;var i=e.n(r);const p=window.wp.compose,c=window.wp.element,m=window.wp.primitives,_=(0,t.createElement)(m.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,t.createElement)(m.Path,{d:"m16.5 13.5-3.7 3.7V4h-1.5v13.2l-3.8-3.7-1 1 5.5 5.6 5.5-5.6z"})),d=(0,t.createElement)(m.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,t.createElement)(m.Path,{d:"M12 3.9 6.5 9.5l1 1 3.8-3.7V20h1.5V6.8l3.7 3.7 1-1z"})),u=(0,t.createElement)(m.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,t.createElement)(m.Path,{d:"M13 11.8l6.1-6.3-1-1-6.1 6.2-6.1-6.2-1 1 6.1 6.3-6.5 6.7 1 1 6.5-6.6 6.5 6.6 1-1z"})),g=(0,t.createElement)(m.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,t.createElement)(m.Path,{d:"M15.6 6.5l-1.1 1 2.9 3.3H8c-.9 0-1.7.3-2.3.9-1.4 1.5-1.4 4.2-1.4 5.6v.2h1.5v-.3c0-1.1 0-3.5 1-4.5.3-.3.7-.5 1.3-.5h9.2L14.5 15l1.1 1.1 4.6-4.6-4.6-5z"})),h=(0,t.createElement)(m.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,t.createElement)(m.Path,{d:"M19 3H5c-.6 0-1 .4-1 1v7c0 .5.4 1 1 1h14c.5 0 1-.4 1-1V4c0-.6-.4-1-1-1zM5.5 10.5v-.4l1.8-1.3 1.3.8c.3.2.7.2.9-.1L11 8.1l2.4 2.4H5.5zm13 0h-2.9l-4-4c-.3-.3-.8-.3-1.1 0L8.9 8l-1.2-.8c-.3-.2-.6-.2-.9 0l-1.3 1V4.5h13v6zM4 20h9v-1.5H4V20zm0-4h16v-1.5H4V16z"})),b={blockId:{type:"string"},post_type:{type:"string",default:"post"},post__in:{type:"array",default:[]},post__not_in:{type:"array",default:[]},filter:{type:"string",default:"{}"},posts_per_page:{type:"string",default:""},orderby:{type:"string",default:"date"},theme:{type:"string",default:"grid"},group_by_month:{type:"boolean",default:!1},columns:{type:"string",default:"1"},more:{type:"string",default:""}},w=e=>{const t={...e};return Object.keys(t).map((e=>{["post__in","post__not_in"].indexOf(e)>=0&&(t[e]=t[e].filter((e=>e))),b[e]&&b[e].default!==t[e]&&""!==t[e]||delete t[e]})),t};(0,o.registerBlockType)("posts-list/preview",{title:(0,l.__)("Posts List","posts-list"),parent:["posts-list/block"],attributes:b});const f=(0,p.compose)([(0,p.withState)(),(0,a.withSelect)(((e,t,o)=>{const{getPostTypes:s,getSite:n,getEntityRecords:a,getTaxonomy:r}=e("core"),{attributes:i}=t;b.posts_per_page.default=(n()||{}).posts_per_page||10;let p=s({per_page:-1})||[];p=p.filter((e=>["attachment","nav_menu_item","wp_block","wp_navigation","wp_template","wp_template_part","wp_global_styles","wp_font_family","wp_font_face"].indexOf(e.slug)<0));const c=(a("postType",i.post_type,{per_page:-1,status:"any",orderby:"title",order:"asc",exclude:e("core/editor").getCurrentPostId()})||[]).map((e=>({value:e.id,label:e.title.rendered||e.title.raw||(0,l.__)("Untitled")}))),m={};return p.forEach((e=>{e.taxonomies.forEach((e=>{const t=a("taxonomy",e,{per_page:100});t&&t.length&&(m[e]={labels:{},terms:t,...r(e)||{}})}))})),{post_types:p,posts:c,taxonomies:m}}))])((({post_types:e,posts:o,taxonomies:a,attributes:r,setAttributes:p,...m})=>{const{blockId:h,post_type:f,post__in:y,post__not_in:v,posts_per_page:E,group_by_month:x,theme:C,columns:k,orderby:N,more:O}=r;(0,c.useEffect)((()=>{h||p({blockId:m.clientId})}));const I=function(e){let t;try{t=decodeURIComponent(e),t=JSON.parse(t)}catch(e){t={}}return t}(r.filter),B=e.filter((e=>e.slug===f))[0]||e[0]||{};if(o.length){let e=[...y];e=e.filter((e=>!e||Object.values(o).some((t=>t.value===e)))),y.length!==e.length&&p({post__in:e})}if(o.length){let e=[...v];e=e.filter((e=>!e||Object.values(o).some((t=>t.value===e)))),v.length!==e.length&&p({post__not_in:e})}const S=document.getElementById(`block-${m.clientId}`);return S&&S.setAttribute("data-grid",r.columns),(0,t.createElement)(t.Fragment,null,(0,t.createElement)(i(),{block:"posts-list/preview",attributes:w(r)}),(0,t.createElement)(s.InspectorControls,null,(0,t.createElement)(n.PanelBody,{title:(0,l.__)("Settings"),className:"posts-list-settings-panel"},(0,t.createElement)(t.Fragment,null,(0,t.createElement)(n.SelectControl,{label:(0,l.__)("Post type"),value:f,options:e.map((e=>({value:e.slug,label:e.name}))),onChange:e=>{p({post_type:e}),p({filter:"{}"}),p({post__in:[]}),p({post__not_in:[]})}}),!!o.length&&(0,t.createElement)(n.BaseControl,{label:(0,l.__)("Show specific %s","posts-list").replace("%s",B.labels?B.labels.name:(0,l.__)("Posts"))},y.map(((e,s)=>(0,t.createElement)(n.Flex,{gap:0},(0,t.createElement)(n.FlexBlock,null,(0,t.createElement)(n.ComboboxControl,{value:e,options:o,placeholder:(0,l.__)("Search for %s to tease â€¦","posts-list").replace("%s",B.labels?B.labels.singular_name:(0,l.__)("Post")),onChange:e=>{null===e?y.splice(s,1):y[s]=e,p({post__in:[...y]})}})),y.length>1&&(0,t.createElement)(n.Button,{size:"small",className:"order-post",iconSize:12,icon:_,disabled:y.length<=s+1,onClick:()=>{const e=[...y],t=e[s];e.splice(s,1),e.splice(s+1,0,t),p({post__in:e})}}),y.length>1&&(0,t.createElement)(n.Button,{size:"small",className:"order-post",iconSize:12,icon:d,disabled:!s,onClick:()=>{const e=[...y],t=e[s];e.splice(s,1),e.splice(s-1,0,t),p({post__in:e})}}),(0,t.createElement)(n.Button,{size:"small",className:"order-post",iconSize:12,icon:u,onClick:()=>{const e=[...y];e.splice(s,1),p({post__in:e})}})))),(0,t.createElement)(n.Button,{variant:"secondary",size:"small",onClick:()=>{const e=[...y];e.push(0),p({post__in:e})}},(0,l.__)("add %s","posts-list").replace("%s",B.labels?B.labels.singular_name:(0,l.__)("Post")))),!y.filter((e=>e)).length&&!!Object.keys(a).length&&!!(B.taxonomies||[]).length&&(0,t.createElement)(n.PanelBody,{title:(0,l.__)("Filter by","posts-list"),className:"posts-list-filter",initialOpen:!1,icon:g},(0,t.createElement)("p",{className:"description"},(0,l.__)("Terms are filtered with OR within a taxonomy and with AND between taxonomies.","posts-list")),B.taxonomies.map((e=>!!a[e]&&(0,t.createElement)(n.BaseControl,{label:a[e].labels.name||e},a[e].terms.map((o=>(0,t.createElement)(n.__experimentalToggleGroupControl,{label:o.name,isDeselectable:!0,value:I[e]?I[e].IN&&I[e].IN.indexOf(o.id)>=0?"IN":I[e]["NOT IN"]&&I[e]["NOT IN"].indexOf(o.id)>=0?"NOT IN":"":"",onChange:t=>{var l;I[e]&&["IN","NOT IN"].forEach((t=>{if(!I[e][t])return;const l=I[e][t].indexOf(o.id);l>=0&&delete I[e][t][l]})),t&&(I[e]||(I[e]={}),I[e][t]||(I[e][t]=[]),I[e][t].push(o.id)),Object.keys(I).forEach((e=>{Object.keys(I[e]).forEach((t=>{I[e][t]=Object.values(I[e][t].filter((e=>e))),I[e][t].length||delete I[e][t]})),Object.keys(I[e]).length||delete I[e]})),p({filter:(l={...I},"object"==typeof l&&null!==l&&(l=encodeURIComponent(JSON.stringify(l))),l)})}},(0,t.createElement)(n.__experimentalToggleGroupControlOption,{value:"IN",label:(0,l.__)("+","posts-list")}),(0,t.createElement)(n.__experimentalToggleGroupControlOption,{value:"NOT IN",label:(0,l.__)("-","posts-list")})))))))),(0,t.createElement)(n.TextControl,{label:(0,l.__)("Theme","posts-list"),value:C!==b.theme.default?C:"",placeholder:b.theme.default,onChange:e=>p({theme:e})}),(0,t.createElement)(n.ToggleControl,{label:(0,l.__)("Group by month","posts-list"),className:"hidden",checked:x,onChange:e=>p({group_by_month:e})}),(0,t.createElement)(n.BaseControl,null,(0,t.createElement)(n.Flex,{align:"start"},(0,t.createElement)(n.FlexBlock,null,(0,t.createElement)(n.__experimentalNumberControl,{label:(0,l.__)("Number of posts","posts-list"),min:-1,value:E,placeholder:b.posts_per_page.default,onChange:e=>p({posts_per_page:e})})),(0,t.createElement)(n.FlexBlock,null,(0,t.createElement)(n.__experimentalNumberControl,{label:(0,l.__)("Columns"),min:1,max:9,value:k,placeholder:b.columns.default,onChange:e=>p({columns:e}),help:(0,l.__)("This setting is theme-dependent.","posts-list")})))),(0,t.createElement)(n.SelectControl,{label:(0,l.__)("Sort by","posts-list"),value:N,options:[{value:"date",label:(0,l.__)("Date")},{value:"menu_order",label:(0,l.__)("Order")},{value:"title",label:(0,l.__)("Title")},{value:"rand",label:(0,l.__)("random","posts-list")}],onChange:e=>p({orderby:e})}),(0,t.createElement)(n.TextControl,{label:(0,l.__)("Load more"),help:(0,l.__)('If there are less results than the setting on "Number of posts", the button is not added.',"posts-list"),placeholder:(0,l.__)("Button text"),value:O,onChange:e=>p({more:e})})))))}));(0,o.registerBlockType)("posts-list/block",{title:(0,l.__)("Posts List","posts-list"),description:(0,l.__)("Add grid of posts.","posts-list"),icon:h,category:"widgets",keywords:[],supports:{anchor:!0,align:["wide","full"],color:{background:!0}},attributes:b,edit:e=>(0,t.createElement)(f,{...e}),save:function({attributes:e,...l}){const o=[];return new URLSearchParams(w(e)).forEach(((e,t)=>{["blockId"].indexOf(t)>=0||o.push(`${t}="${e}"`)})),(0,t.createElement)("div",{"data-uuid":e.blockId,"data-grid":e.columns,className:`${e.post_type}-posts-list wp-block-group is-layout-${e.theme||b.theme.default} wp-block-group-is-layout-${e.theme||b.theme.default}`},(0,t.createElement)(c.RawHTML,null,`[posts-list ${o.join(" ")}]`))}})})();